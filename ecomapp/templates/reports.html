{% extends 'base.html' %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Financial Reports</h1>
    <p class="text-gray-600 mt-2">Analyze your financial performance with detailed reports</p>
</div>

<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4">Select Period</h2>
    <form method="get" class="flex items-end space-x-4">
        <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-2">Period</label>
            <select name="period" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="week" {% if period == 'week' %}selected{% endif %}>Last 7 Days</option>
                <option value="month" {% if period == 'month' %}selected{% endif %}>Last 30 Days</option>
                <option value="quarter" {% if period == 'quarter' %}selected{% endif %}>Last 90 Days</option>
                <option value="year" {% if period == 'year' %}selected{% endif %}>Last Year</option>
            </select>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
            Generate Report
        </button>
    </form>
</div>

<div class="grid md:grid-cols-3 gap-6 mb-8">
    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white">
        <h3 class="text-sm font-medium opacity-90">Total Income</h3>
        <p class="text-3xl font-bold mt-2">${{ total_income }}</p>
        <p class="text-sm opacity-75 mt-2">{{ income_count }} transactions</p>
    </div>
    
    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg p-6 text-white">
        <h3 class="text-sm font-medium opacity-90">Total Expenses</h3>
        <p class="text-3xl font-bold mt-2">${{ total_expense }}</p>
        <p class="text-sm opacity-75 mt-2">{{ expense_count }} transactions</p>
    </div>
    
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white">
        <h3 class="text-sm font-medium opacity-90">Net Profit/Loss</h3>
        <p class="text-3xl font-bold mt-2">${{ net_profit }}</p>
        <p class="text-sm opacity-75 mt-2">
            {% if net_profit >= 0 %}Profit{% else %}Loss{% endif %}
        </p>
    </div>
</div>

<div class="grid md:grid-cols-2 gap-6">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-6">Expense Breakdown</h2>
        <div class="space-y-4">
            {% for cat in expense_by_category %}
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">{{ cat.category__name|default:"Uncategorized" }}</span>
                    <span class="font-semibold text-red-600">${{ cat.total }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="bg-gradient-to-r from-red-500 to-red-600 h-3 rounded-full" 
                         style="width: {% if total_expense > 0 %}{% widthratio cat.total total_expense 100 %}{% else %}0{% endif %}%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                    {% if total_expense > 0 %}{% widthratio cat.total total_expense 100 %}{% else %}0{% endif %}% of total expenses
                </p>
            </div>
            {% empty %}
            <p class="text-gray-500 text-center py-8">No expense data available</p>
            {% endfor %}
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-6">Income Breakdown</h2>
        <div class="space-y-4">
            {% for cat in income_by_category %}
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">{{ cat.category__name|default:"Uncategorized" }}</span>
                    <span class="font-semibold text-green-600">${{ cat.total }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full" 
                         style="width: {% if total_income > 0 %}{% widthratio cat.total total_income 100 %}{% else %}0{% endif %}%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                    {% if total_income > 0 %}{% widthratio cat.total total_income 100 %}{% else %}0{% endif %}% of total income
                </p>
            </div>
            {% empty %}
            <p class="text-gray-500 text-center py-8">No income data available</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
